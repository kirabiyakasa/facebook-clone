<div id="posts-container">
  <% @posts.each do |post| %>
    <div class="post">

      <div class="post-main">
        <div class="post-header">
          <div class="post-user">
            <%# condition to check if user exists %>
            <%= link_to post.user do %>
              <%= post.user.name %>
            <% end %>
            <%# end %>
          </div>
          <div class="post-date">
            <%= post.created_at %>
          </div>
        </div>
        <div class="post-body">
          <%= post.body %>
        </div>
      </div>

      <div class="post-sub">
        <div class="likes-dislikes">
          <div class="likes">
            <%= post.likes.length %>
          </div>
          <div class="dislikes">
            <%= post.dislikes.length %>
          </div>
        </div>
        <div class="comments-indicator" data-comments-indicator-id="<%= post.id %>">
          <% if post.comments.any? %>
            <%= "#{post.comments.length + post.replies.length} Comments" %>
          <% end%>
        </div>
      </div>

      <div class="post-options">
        <span>Comment</span><span>Share</span>
      </div>

      <section id="comment-section" data-comment-section-id="<%= post.id %>">
        <% if post.comments.any? %>
          <%= link_to "View #{post.comments.length} previous comments",
              section_post_comments_path(post.id), remote: true %>
              <% comment = post.comments.sort_by{
                  |comment| comment.created_at
                }.last
              %>
              <%# preview comment %>
                <%= comment.created_at %>
                <%= comment.body %>
              <%# preview comment end%>
              <%= "#{comment.replies.length} Replies" %>
        <% end %>
      </section>

      <div class="reply-bar">
        <%= form_with url: "/posts/#{post.id}/comment", method: 'post' do |f| %>
          <%= f.text_area :body %>
          <%= f.submit 'Submit Comment' %>
        <% end %>
      </div>

    </div>
  <% end %>
</div>

<%== pagy_nav(@pagy) %>
